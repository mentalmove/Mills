function Rules(n,a,b){var d={white:9,black:9};var m=[];var o=this;function l(q){var i=document.createElement("script");i.setAttribute("type","text/javascript");i.setAttribute("src",q);document.getElementsByTagName("head")[0].appendChild(i);i.onload=setTimeout(function(r){r.parentNode.removeChild(r)},41,i)}function p(r,q){var s,u,i,t;if(r%2){s=r%8;if(m[s]==q&&m[s+8]==q&&m[s+16]==q){return true}u=[(r-1),r,(r+1)];if(u[2]%8==0){u[2]-=8}if(m[u[0]]==q&&m[u[1]]==q&&m[u[2]]==q){return true}}else{i=Math.floor(r/8)*8;t=i+7;u=[(r-2),(r-1),r];while(u[0]<i){u[0]+=8}while(u[1]<i){u[1]+=8}if(m[u[0]]==q&&m[u[1]]==q&&m[u[2]]==q){return true}u=[r,(r+1),(r+2)];while(u[2]>t){u[2]-=8}while(u[1]>t){u[1]-=8}if(m[u[0]]==q&&m[u[1]]==q&&m[u[2]]==q){return true}}return false}function k(s){var q;var r=[];for(q=0;q<m.length;q++){if(m[q]!=-1){continue}if(s&&p(q,-1)){continue}r.push(q)}if(s&&!r.length){k(false);return}for(q=0;q<r.length;q++){a[r[q]].enable_remove()}n.en_dis_able_remove(true)}function j(){var q=0;var s=0;for(var r=0;r<m.length;r++){if(m[r]==1){q++}if(m[r]==-1){s++}}n.phase=["lost","lost"];if(q==3){n.phase[0]="jump"}if(s==3){n.phase[1]="jump"}if(q>3){n.phase[0]="move"}if(s>3){n.phase[1]="move"}if(n.phase[0]=="lost"){o.game_end("black");return}if(n.phase[1]=="lost"){o.game_end("white")}}function f(){var t={};var s=[];var q=[];var r;for(r=0;r<m.length;r++){if(m[r]==0){s.push(r);a[r].update_location();q.push(a[r].style.location)}}for(r=0;r<m.length;r++){if(m[r]!=1){continue}t[r]=s;a[r].update_location()}for(var u in t){a[parseInt(u)].enable_move(s,q)}}function h(){var y={};var s=0;var v,w,r,x,A,u,z,t;for(t=0;t<m.length;t++){if(m[t]!=1){continue}v=(t%8)?t-1:t+7;w=(t%8!=7)?t+1:t-7;r=-1;x=-1;if(t%2){if(t-8>=0){x=t-8}if(t+8<m.length){r=t+8}}u=[];if(!m[v]){u.push(v)}if(!m[w]){u.push(w)}if(r!=-1&&!m[r]){u.push(r)}if(x!=-1&&!m[x]){u.push(x)}if(u.length){y[t]=u;s++}}if(!s){o.game_end("black")}else{for(var q in y){a[parseInt(q)].update_location();u=[];z=[];for(t=0;t<y[q].length;t++){a[y[q][t]].update_location();u.push(a[y[q][t]].style.location);z.push(y[q][t])}a[parseInt(q)].enable_move(z,u)}}}this.game_end=function(i){n.game_end(i)};this.swap_pieces=function(t,q,s){n.status="wait";a[t].remove_piece();a[q].set_piece(s);m[t]=0;m[q]=(s=="white")?1:-1;if(s=="white"){for(var r=0;r<a.length;r++){if(a[r].piece){a[r].disable_move()}}if(p(q,1)){k(true)}else{g.search_move()}}else{if(p(q,-1)){g.remove_piece();setTimeout(c,1234)}else{c()}}};this.remove_piece=function(i,q){m[i]=0;a[i].remove_piece();if(q=="white"){if(n.phase=="begin"){n.enable_set()}n.status="human"}else{n.status="wait";if(n.phase=="begin"){setTimeout(g.search_move,666)}else{j();setTimeout(g.search_move,666)}}n.en_dis_able_remove(false)};function c(){j();if(n.phase[0]=="move"){h()}else{f()}}this.set_piece=function(q,r){if(m[q]){a[q].disable_set();return false}d[r]--;m[q]=(r=="white")?1:-1;if(r=="black"&&d[r]<=0&&n.phase=="begin"){n.phase="move"}var i;if(r=="black"){a[q].set_piece("black");i=p(q,-1);if(i){n.en_dis_able_remove(true);g.remove_piece();if(n.phase=="begin"){return true}}if(n.phase=="begin"){n.enable_set()}else{if(i){setTimeout(c,1234)}else{c()}}n.status="human";return true}n.status="wait";if(p(q,1)){k(true);return true}g.search_move();return true};for(var e=0;e<a.length;e++){m[e]=0}n.status="human";b();var g=new Delegate(this,m,d)};